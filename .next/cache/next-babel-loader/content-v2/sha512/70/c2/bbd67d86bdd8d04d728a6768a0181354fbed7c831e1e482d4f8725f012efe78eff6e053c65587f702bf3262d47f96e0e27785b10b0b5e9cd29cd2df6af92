{"ast":null,"code":"import _regeneratorRuntime from \"/Users/citelsistema/Desktop/ignite-aulas/Reactjs/Chapter03/ignews/node_modules/@babel/runtime/regenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _asyncToGenerator from \"/Users/citelsistema/Desktop/ignite-aulas/Reactjs/Chapter03/ignews/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/citelsistema/Desktop/ignite-aulas/Reactjs/Chapter03/ignews/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/citelsistema/Desktop/ignite-aulas/Reactjs/Chapter03/ignews/src/components/SubscribeButton/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { signIn, useSession } from 'next-auth/client';\nimport { api } from '../../services/api';\nimport { getStripeJs } from '../../services/stripe-js';\nimport styles from './styles.module.scss';\nexport function SubscribeButton(_ref) {\n  _s();\n\n  var priceId = _ref.priceId;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 1),\n      session = _useSession2[0];\n\n  function handleSubscribe() {\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  function _handleSubscribe() {\n    _handleSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, sessionId, stripe;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (session) {\n                _context.next = 3;\n                break;\n              }\n\n              signIn('github');\n              return _context.abrupt(\"return\");\n\n            case 3:\n              if (session) {}\n\n              _context.prev = 4;\n              _context.next = 7;\n              return api.post('/subscribe');\n\n            case 7:\n              response = _context.sent;\n              sessionId = response.data.sessionId;\n              _context.next = 11;\n              return getStripeJs();\n\n            case 11:\n              stripe = _context.sent;\n              _context.next = 14;\n              return stripe.redirectToCheckout({\n                sessionId: sessionId\n              });\n\n            case 14:\n              _context.next = 19;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](4);\n              alert('falhouuu');\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 16]]);\n    }));\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    type: \"button\",\n    className: styles.subscribeButton,\n    onClick: handleSubscribe,\n    children: \"Subscribe now\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 37,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SubscribeButton, \"Vxy5gMemEU/s8dbgarDyE2/t+kg=\", false, function () {\n  return [useSession];\n});\n\n_c = SubscribeButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubscribeButton\");","map":{"version":3,"sources":["/Users/citelsistema/Desktop/ignite-aulas/Reactjs/Chapter03/ignews/src/components/SubscribeButton/index.tsx"],"names":["signIn","useSession","api","getStripeJs","styles","SubscribeButton","priceId","session","handleSubscribe","post","response","sessionId","data","stripe","redirectToCheckout","alert","subscribeButton"],"mappings":";;;;;;;;AAAA,SAASA,MAAT,EAAiBC,UAAjB,QAAmC,kBAAnC;AACA,SAASC,GAAT,QAAoB,oBAApB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AAMA,OAAO,SAASC,eAAT,OAA6D;AAAA;;AAAA,MAAjCC,OAAiC,QAAjCA,OAAiC;;AAAA,oBAChDL,UAAU,EADsC;AAAA;AAAA,MAC3DM,OAD2D;;AAAA,WAGnDC,eAHmD;AAAA;AAAA;;AAAA;AAAA,gFAGlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACMD,OADN;AAAA;AAAA;AAAA;;AAEIP,cAAAA,MAAM,CAAC,QAAD,CAAN;AAFJ;;AAAA;AAME,kBAAGO,OAAH,EAAY,CAEX;;AARH;AAAA;AAAA,qBAW2BL,GAAG,CAACO,IAAJ,CAAS,YAAT,CAX3B;;AAAA;AAWUC,cAAAA,QAXV;AAaYC,cAAAA,SAbZ,GAa0BD,QAAQ,CAACE,IAbnC,CAaYD,SAbZ;AAAA;AAAA,qBAeyBR,WAAW,EAfpC;;AAAA;AAeUU,cAAAA,MAfV;AAAA;AAAA,qBAiBUA,MAAM,CAACC,kBAAP,CAA0B;AAACH,gBAAAA,SAAS,EAATA;AAAD,eAA1B,CAjBV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAmBII,cAAAA,KAAK,CAAC,UAAD,CAAL;;AAnBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAHkE;AAAA;AAAA;;AA0BlE,sBACE;AACA,IAAA,IAAI,EAAC,QADL;AAEA,IAAA,SAAS,EAAEX,MAAM,CAACY,eAFlB;AAGA,IAAA,OAAO,EAAER,eAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AASD;;GAnCeH,e;UACIJ,U;;;KADJI,e","sourcesContent":["import { signIn, useSession } from 'next-auth/client';\nimport { api } from '../../services/api';\nimport { getStripeJs } from '../../services/stripe-js';\nimport styles from './styles.module.scss';\n\ninterface SubscribeButtonProps {\n  priceId: string;\n}\n\nexport function SubscribeButton ({ priceId }: SubscribeButtonProps) {\n  const [session] = useSession();\n\n  async function handleSubscribe() {\n    if(!session) {\n      signIn('github');\n      return;\n    }\n\n    if(session) {\n\n    }\n\n    try {\n      const response = await api.post('/subscribe')\n      \n      const { sessionId } = response.data;\n\n      const stripe = await getStripeJs()\n\n      await stripe.redirectToCheckout({sessionId})\n    } catch (err) {\n      alert('falhouuu');\n    }\n  }\n\n  return (\n    <button\n    type=\"button\"\n    className={styles.subscribeButton}\n    onClick={handleSubscribe}\n    >\n       Subscribe now\n    </button>\n  );\n}"]},"metadata":{},"sourceType":"module"}